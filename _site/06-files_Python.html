<p>::::::::::::::::::::::::::::::::::::::: objectives</p>

<ul>
  <li>Use a library function to get a list of filenames that match a wildcard pattern.</li>
  <li>Write a <code class="language-plaintext highlighter-rouge">for</code> loop to process multiple files.</li>
</ul>

<p>::::::::::::::::::::::::::::::::::::::::::::::::::</p>

<p>:::::::::::::::::::::::::::::::::::::::: questions</p>

<ul>
  <li>How can I do the same operations on many different files?</li>
</ul>

<p>::::::::::::::::::::::::::::::::::::::::::::::::::</p>

<p>As a final piece to processing our inflammation data, we need a way to get a list of all the files
in our <code class="language-plaintext highlighter-rouge">data</code> directory whose names start with <code class="language-plaintext highlighter-rouge">inflammation-</code> and end with <code class="language-plaintext highlighter-rouge">.csv</code>.
The following library will help us to achieve this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">glob</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">glob</code> library contains a function, also called <code class="language-plaintext highlighter-rouge">glob</code>,
that finds files and directories whose names match a pattern.
We provide those patterns as strings:
the character <code class="language-plaintext highlighter-rouge">*</code> matches zero or more characters,
while <code class="language-plaintext highlighter-rouge">?</code> matches any one character.
We can use this to get the names of all the CSV files in the current directory:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">glob</span><span class="p">.</span><span class="n">glob</span><span class="p">(</span><span class="s">'inflammation*.csv'</span><span class="p">))</span>
</code></pre></div></div>

<pre><code class="language-output">['inflammation-05.csv', 'inflammation-11.csv', 'inflammation-12.csv', 'inflammation-08.csv',
'inflammation-03.csv', 'inflammation-06.csv', 'inflammation-09.csv', 'inflammation-07.csv',
'inflammation-10.csv', 'inflammation-02.csv', 'inflammation-04.csv', 'inflammation-01.csv']
</code></pre>

<p>As these examples show,
<code class="language-plaintext highlighter-rouge">glob.glob</code>’s result is a list of file and directory paths in arbitrary order.
This means we can loop over it
to do something with each filename in turn.
In our case,
the “something” we want to do is generate a set of plots for each file in our inflammation dataset.</p>

<p>If we want to start by analyzing just the first three files in alphabetical order, we can use the
<code class="language-plaintext highlighter-rouge">sorted</code> built-in function to generate a new sorted list from the <code class="language-plaintext highlighter-rouge">glob.glob</code> output:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>

<span class="n">filenames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">.</span><span class="n">glob</span><span class="p">(</span><span class="s">'inflammation*.csv'</span><span class="p">))</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">','</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="p">.</span><span class="n">pyplot</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">))</span>

    <span class="n">axes1</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">axes2</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">axes3</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">axes1</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'average'</span><span class="p">)</span>
    <span class="n">axes1</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numpy</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="n">axes2</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'max'</span><span class="p">)</span>
    <span class="n">axes2</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numpy</span><span class="p">.</span><span class="n">amax</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="n">axes3</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'min'</span><span class="p">)</span>
    <span class="n">axes3</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numpy</span><span class="p">.</span><span class="n">amin</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="n">fig</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">matplotlib</span><span class="p">.</span><span class="n">pyplot</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<pre><code class="language-output">inflammation-01.csv
</code></pre>

<p><img src="fig/03-loop_49_1.png" alt="" />{alt=’Output from the first iteration of the for loop. Three line graphs showing the daily average, maximum and minimum inflammation over a 40-day period for all patients in the first dataset.’}</p>

<pre><code class="language-output">inflammation-02.csv
</code></pre>

<p><img src="fig/03-loop_49_3.png" alt="" />{alt=’Output from the second iteration of the for loop. Three line graphs showing the daily average, maximum and minimum inflammation over a 40-day period for all patients in the seconddataset.’}</p>

<pre><code class="language-output">inflammation-03.csv
</code></pre>

<p><img src="fig/03-loop_49_5.png" alt="" />{alt=’Output from the third iteration of the for loop. Three line graphs showing the daily average, maximum and minimum inflammation over a 40-day period for all patients in the thirddataset.’}</p>

<p>The plots generated for the second clinical trial file look very similar to the plots for
the first file: their average plots show similar “noisy” rises and falls; their maxima plots
show exactly the same linear rise and fall; and their minima plots show similar staircase
structures.</p>

<p>The third dataset shows much noisier average and maxima plots that are far less suspicious than
the first two datasets, however the minima plot shows that the third dataset minima is
consistently zero across every day of the trial. If we produce a heat map for the third data file
we see the following:</p>

<p><img src="fig/inflammation-03-imshow.svg" alt="" />{alt=’Heat map of the third inflammation dataset. Note that there are sporadic zero values throughoutthe entire dataset, and the last patient only has zero values over the 40 day study.’}</p>

<p>We can see that there are zero values sporadically distributed across all patients and days of the
clinical trial, suggesting that there were potential issues with data collection throughout the
trial. In addition, we can see that the last patient in the study didn’t have any inflammation
flare-ups at all throughout the trial, suggesting that they may not even suffer from arthritis!</p>

<p>:::::::::::::::::::::::::::::::::::::::  challenge</p>

<h2 id="plotting-differences">Plotting Differences</h2>

<p>Plot the difference between the average inflammations reported in the first and second datasets
(stored in <code class="language-plaintext highlighter-rouge">inflammation-01.csv</code> and <code class="language-plaintext highlighter-rouge">inflammation-02.csv</code>, correspondingly),
i.e., the difference between the leftmost plots of the first two figures.</p>

<p>:::::::::::::::  solution</p>

<h2 id="solution">Solution</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>

<span class="n">filenames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">.</span><span class="n">glob</span><span class="p">(</span><span class="s">'inflammation*.csv'</span><span class="p">))</span>

<span class="n">data0</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">','</span><span class="p">)</span>
<span class="n">data1</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">filenames</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">','</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="p">.</span><span class="n">pyplot</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">))</span>

<span class="n">matplotlib</span><span class="p">.</span><span class="n">pyplot</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Difference in average'</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="p">.</span><span class="n">pyplot</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numpy</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">numpy</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">fig</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">matplotlib</span><span class="p">.</span><span class="n">pyplot</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p>:::::::::::::::::::::::::</p>

<p>::::::::::::::::::::::::::::::::::::::::::::::::::</p>

<p>:::::::::::::::::::::::::::::::::::::::  challenge</p>

<h2 id="generate-composite-statistics">Generate Composite Statistics</h2>

<p>Use each of the files once to generate a dataset containing values averaged over all patients by completing the code inside the loop given below:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="p">.</span><span class="n">glob</span><span class="p">(</span><span class="s">'inflammation*.csv'</span><span class="p">)</span>
<span class="n">composite_data</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">60</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
    <span class="c1"># sum each new file's data into composite_data as it's read
</span>    <span class="c1">#
# and then divide the composite_data by number of samples
</span><span class="n">composite_data</span> <span class="o">=</span> <span class="n">composite_data</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</code></pre></div></div>

<p>Then use pyplot to generate average, max, and min for all patients.</p>

<p>:::::::::::::::  solution</p>

<h2 id="solution-1">Solution</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>

<span class="n">filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="p">.</span><span class="n">glob</span><span class="p">(</span><span class="s">'inflammation*.csv'</span><span class="p">)</span>
<span class="n">composite_data</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">60</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>

<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fname</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">','</span><span class="p">)</span>
    <span class="n">composite_data</span> <span class="o">=</span> <span class="n">composite_data</span> <span class="o">+</span> <span class="n">data</span>

<span class="n">composite_data</span> <span class="o">=</span> <span class="n">composite_data</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="p">.</span><span class="n">pyplot</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">))</span>

<span class="n">axes1</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axes2</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">axes3</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">axes1</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'average'</span><span class="p">)</span>
<span class="n">axes1</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numpy</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">composite_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">axes2</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'max'</span><span class="p">)</span>
<span class="n">axes2</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numpy</span><span class="p">.</span><span class="n">amax</span><span class="p">(</span><span class="n">composite_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">axes3</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'min'</span><span class="p">)</span>
<span class="n">axes3</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numpy</span><span class="p">.</span><span class="n">amin</span><span class="p">(</span><span class="n">composite_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">fig</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">matplotlib</span><span class="p">.</span><span class="n">pyplot</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p>:::::::::::::::::::::::::</p>

<p>::::::::::::::::::::::::::::::::::::::::::::::::::</p>

<p>After spending some time investigating the heat map and statistical plots, as well as
doing the above exercises to plot differences between datasets and to generate composite
patient statistics, we gain some insight into the twelve clinical trial datasets.</p>

<p>The datasets appear to fall into two categories:</p>

<ul>
  <li>seemingly “ideal” datasets that agree excellently with Dr. Maverick’s claims,
but display suspicious maxima and minima (such as <code class="language-plaintext highlighter-rouge">inflammation-01.csv</code> and <code class="language-plaintext highlighter-rouge">inflammation-02.csv</code>)</li>
  <li>“noisy” datasets that somewhat agree with Dr. Maverick’s claims, but show concerning
data collection issues such as sporadic missing values and even an unsuitable candidate
making it into the clinical trial.</li>
</ul>

<p>In fact, it appears that all three of the “noisy” datasets (<code class="language-plaintext highlighter-rouge">inflammation-03.csv</code>,
<code class="language-plaintext highlighter-rouge">inflammation-08.csv</code>, and <code class="language-plaintext highlighter-rouge">inflammation-11.csv</code>) are identical down to the last value.
Armed with this information, we confront Dr. Maverick about the suspicious data and
duplicated files.</p>

<p>Dr. Maverick has admitted to fabricating the clinical data for their drug trial. They did this after discovering that the initial trial had several issues, including unreliable data recording and poor participant selection. In order to prove the efficacy of their drug, they created fake data. When asked for additional data, they attempted to generate more fake datasets, and also included the original poor-quality dataset several times in order to make the trials seem more realistic.</p>

<p>Congratulations! We’ve investigated the inflammation data and proven that the datasets have been
synthetically generated.</p>

<p>But it would be a shame to throw away the synthetic datasets that have taught us so much
already, so we’ll forgive the imaginary Dr. Maverick and continue to use the data to learn
how to program.</p>

<p>:::::::::::::::::::::::::::::::::::::::: keypoints</p>

<ul>
  <li>Use <code class="language-plaintext highlighter-rouge">glob.glob(pattern)</code> to create a list of files whose names match a pattern.</li>
  <li>Use <code class="language-plaintext highlighter-rouge">*</code> in a pattern to match zero or more characters, and <code class="language-plaintext highlighter-rouge">?</code> to match any single character.</li>
</ul>

<p>::::::::::::::::::::::::::::::::::::::::::::::::::</p>

